<?xml version="1.0" encoding="UTF-8"?>

<beans xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.springframework.org/schema/beans">

	<!--************************************************************************
    	* Custom Systems
    	*************************************************************************-->
	<import resource="fixtures.systems.xml"/>
	
	<!--************************************************************************
    * Data Generators
    *************************************************************************-->
	<bean id="datagen.spark.operator.stats.2.5.Gb" class="eu.stratosphere.peel.extensions.spark.beans.job.SparkJob">
		<constructor-arg name="runner" ref="spark-1.3.1"/>
		<constructor-arg name="command">
			<value>--class eu.stratosphere.procrustes.datagen.spark.SparkIntGenerator
				${app.path.datagens}/procrustes-datagen-1.0-SNAPSHOT.jar
				${system.spark.config.defaults.spark.master}
				${system.default.config.parallelism.total}
				195312
				${system.hadoop-2.path.input}/operatorstats
			</value>
		</constructor-arg>
	</bean>

	<!--************************************************************************
    * Data Sets -> Number of nodes and distribution determines the sets
    *************************************************************************-->
	<bean id="dataset.operator.stats.2.5.Gb" parent="dataset.generated.hdfs-2">
		<constructor-arg name="src" ref="datagen.spark.operator.stats.2.5.Gb"/>
		<constructor-arg name="dst" value="${system.hadoop-2.path.input}/operatorstats"/>
	</bean>

	<!--************************************************************************
    * Experiments
    *************************************************************************-->
    
    <!--No accumulators-->
	<bean id="experiment.flink.operator.stats.none" parent="experiment.flink-0.9-SNAPSHOT-tmendt" abstract="true">
		<constructor-arg name="command">
			<value>${app.path.jobs}/procrustes-flink-1.0-SNAPSHOT.jar
				--class eu.stratosphere.procrustes.experiments.flink.operatorstats.OperatorStatisticsExperiment
				${system.hadoop-2.path.input}/operatorstats
				none
			</value>
		</constructor-arg>
		<constructor-arg name="inputs">
			<set value-type="eu.stratosphere.peel.core.beans.data.GeneratedDataSet">
				<ref bean="dataset.operator.stats.2.5.Gb"/>
			</set>
		</constructor-arg>
	</bean>

	<!--Max / Min-->
	<bean id="experiment.flink.operator.stats.minmax" parent="experiment.flink-0.9-SNAPSHOT-tmendt" abstract="true">
		<constructor-arg name="command">
			<value>${app.path.jobs}/procrustes-flink-1.0-SNAPSHOT.jar
				--class eu.stratosphere.procrustes.experiments.flink.operatorstats.OperatorStatisticsExperiment
				${system.hadoop-2.path.input}/operatorstats
				minmax
			</value>
		</constructor-arg>
		<constructor-arg name="inputs">
			<set value-type="eu.stratosphere.peel.core.beans.data.GeneratedDataSet">
				<ref bean="dataset.operator.stats.2.5.Gb"/>
			</set>
		</constructor-arg>
	</bean>
	
	<!--Linear Counting Uniform-->
	<bean id="experiment.flink.operator.stats.linearc" parent="experiment.flink-0.9-SNAPSHOT-tmendt" abstract="true">
		<constructor-arg name="command">
			<value>${app.path.jobs}/procrustes-flink-1.0-SNAPSHOT.jar
				--class eu.stratosphere.procrustes.experiments.flink.operatorstats.OperatorStatisticsExperiment
				${system.hadoop-2.path.input}/operatorstats
				linearc
			</value>
		</constructor-arg>
		<constructor-arg name="inputs">
			<ref bean="dataset.operator.stats.2.5.Gb"/>
		</constructor-arg>
	</bean>
		
	<!--HyperLogLog-->
	<bean id="experiment.flink.operator.stats.hyperloglog" parent="experiment.flink-0.9-SNAPSHOT-tmendt" abstract="true">
		<constructor-arg name="command">
			<value>${app.path.jobs}/procrustes-flink-1.0-SNAPSHOT.jar
				--class eu.stratosphere.procrustes.experiments.flink.operatorstats.OperatorStatisticsExperiment
				${system.hadoop-2.path.input}/operatorstats
				hyperloglog
			</value>
		</constructor-arg>
		<constructor-arg name="inputs">
			<ref bean="dataset.operator.stats.2.5.Gb"/>
		</constructor-arg>
	</bean>
			
	<!--Lossy Counting-->
	<bean id="experiment.flink.operator.stats.lossy" parent="experiment.flink-0.9-SNAPSHOT-tmendt" abstract="true">
		<constructor-arg name="command">
			<value>${app.path.jobs}/procrustes-flink-1.0-SNAPSHOT.jar
				--class eu.stratosphere.procrustes.experiments.flink.operatorstats.OperatorStatisticsExperiment
				${system.hadoop-2.path.input}/operatorstats
				lossy
			</value>
		</constructor-arg>
		<constructor-arg name="inputs">
			<ref bean="dataset.operator.stats.2.5.Gb"/>
		</constructor-arg>
	</bean>
		
	<!--Count Min Sketch-->
	<bean id="experiment.flink.operator.stats.countmin" parent="experiment.flink-0.9-SNAPSHOT-tmendt" abstract="true">
		<constructor-arg name="command">
			<value>${app.path.jobs}/procrustes-flink-1.0-SNAPSHOT.jar
				--class eu.stratosphere.procrustes.experiments.flink.operatorstats.OperatorStatisticsExperiment
				${system.hadoop-2.path.input}/operatorstats
				countmin
			</value>
		</constructor-arg>
		<constructor-arg name="inputs">
			<ref bean="dataset.operator.stats.2.5.Gb"/>
		</constructor-arg>
	</bean>

	<!--************************************************************************
    * Fixtures
    *************************************************************************-->
	<!-- fixtures for local development and testing -->
	<bean id="operator.stats.processing" class="eu.stratosphere.peel.core.beans.experiment.ExperimentSuite">
		<constructor-arg name="experiments">
			<list>
				<bean parent="experiment.flink.operator.stats.none">
					<constructor-arg name="name" value="flink.operator.stats.none"/>
					<constructor-arg name="config">
						<value/>
					</constructor-arg>
					<constructor-arg name="outputs">
						<value/>
					</constructor-arg>
				</bean>
				<bean parent="experiment.flink.operator.stats.minmax">
					<constructor-arg name="name" value="flink.operator.stats.minmax"/>
					<constructor-arg name="config">
						<value/>
					</constructor-arg>
					<constructor-arg name="outputs">
						<value/>
					</constructor-arg>
				</bean>
				<bean parent="experiment.flink.operator.stats.linearc">
					<constructor-arg name="name" value="flink.operator.stats.linearc"/>
					<constructor-arg name="config">
						<value/>
					</constructor-arg>
					<constructor-arg name="outputs">
						<value/>
					</constructor-arg>
				</bean>
				<bean parent="experiment.flink.operator.stats.hyperloglog">
					<constructor-arg name="name" value="flink.operator.stats.hyperloglog"/>
					<constructor-arg name="config">
						<value/>
					</constructor-arg>
					<constructor-arg name="outputs">
						<value/>
					</constructor-arg>
				</bean>
				<bean parent="experiment.flink.operator.stats.lossy">
					<constructor-arg name="name" value="flink.operator.stats.lossy"/>
					<constructor-arg name="config">
						<value/>
					</constructor-arg>
					<constructor-arg name="outputs">
						<value/>
					</constructor-arg>
				</bean>
				<bean parent="experiment.flink.operator.stats.countmin">
					<constructor-arg name="name" value="flink.operator.stats.countmin"/>
					<constructor-arg name="config">
						<value/>
					</constructor-arg>
					<constructor-arg name="outputs">
						<value/>
					</constructor-arg>
				</bean>
			</list>
		</constructor-arg>
	</bean>

</beans>
